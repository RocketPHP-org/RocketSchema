{
  "@type": "Schema",
  "@context": "https://rocketschema.org/context",
  "name": "Permission",
  "description": "A granular permission with ABAC (Attribute-Based Access Control) support for fine-grained access control",
  "properties": [
    {
      "name": "code",
      "type": "string",
      "mode": "stored",
      "description": "Unique permission code",
      "required": true,
      "unique": true,
      "example": "user.create"
    },
    {
      "name": "name",
      "type": "string",
      "mode": "stored",
      "description": "Human-readable permission name",
      "required": true,
      "example": "Create User"
    },
    {
      "name": "description",
      "type": "string",
      "mode": "stored",
      "description": "Detailed description of what this permission allows",
      "example": "Allows creating new user accounts"
    },
    {
      "name": "resource",
      "type": "string",
      "mode": "stored",
      "description": "Resource this permission applies to",
      "required": true,
      "example": "user"
    },
    {
      "name": "action",
      "type": "string",
      "mode": "stored",
      "description": "Action allowed on the resource",
      "required": true,
      "example": "create"
    },
    {
      "name": "effect",
      "type": "string",
      "mode": "enum",
      "description": "Whether this permission allows or denies access",
      "enum": ["allow", "deny"],
      "default": "allow",
      "example": "allow"
    },
    {
      "name": "scope",
      "type": "string",
      "mode": "enum",
      "description": "Scope of the permission",
      "enum": ["global", "organization", "department", "team", "project", "self", "custom"],
      "default": "organization",
      "example": "organization"
    },
    {
      "name": "scopeExpression",
      "type": "string",
      "mode": "stored",
      "description": "Custom scope expression for complex scoping rules",
      "nullable": true,
      "example": "organization.id == user.organizationId && department.region == 'EU'"
    },
    {
      "name": "category",
      "type": "string",
      "mode": "stored",
      "description": "Category for grouping permissions",
      "example": "User Management"
    },
    {
      "name": "priority",
      "type": "integer",
      "mode": "stored",
      "description": "Priority for conflict resolution (higher = higher priority)",
      "default": 0,
      "min": 0
    },
    {
      "name": "isSystem",
      "type": "boolean",
      "mode": "stored",
      "description": "Whether this is a protected system permission",
      "default": false
    },
    {
      "name": "isActive",
      "type": "boolean",
      "mode": "stored",
      "description": "Whether the permission is active",
      "default": true
    },
    {
      "name": "validFrom",
      "type": "DateTime",
      "mode": "stored",
      "description": "Start of validity period",
      "nullable": true
    },
    {
      "name": "validUntil",
      "type": "DateTime",
      "mode": "stored",
      "description": "End of validity period",
      "nullable": true
    },
    {
      "name": "createdAt",
      "type": "DateTime",
      "mode": "stored",
      "description": "Creation timestamp",
      "required": true
    },
    {
      "name": "createdBy",
      "type": "User",
      "mode": "stored",
      "description": "User who created this permission"
    },
    {
      "name": "updatedAt",
      "type": "DateTime",
      "mode": "stored",
      "description": "Last update timestamp"
    },
    {
      "name": "version",
      "type": "integer",
      "mode": "stored",
      "description": "Version number for optimistic locking",
      "default": 1
    }
  ],
  "relationships": {
    "attributes": {
      "type": "one-to-many",
      "entity": "PermissionAttribute",
      "foreign_key": "permission"
    },
    "conditions": {
      "type": "many-to-many",
      "entity": "PermissionCondition",
      "junction": "PermissionConditionLink"
    },
    "dataFilters": {
      "type": "one-to-many",
      "entity": "DataFilter",
      "foreign_key": "permission"
    },
    "fieldRestrictions": {
      "type": "one-to-many",
      "entity": "FieldRestriction",
      "foreign_key": "permission"
    },
    "dependencies": {
      "type": "many-to-many",
      "entity": "Permission",
      "junction": "PermissionDependency"
    }
  },
  "indexes": [
    {
      "fields": ["code"],
      "unique": true
    },
    {
      "fields": ["resource", "action"],
      "name": "idx_resource_action"
    },
    {
      "fields": ["category"],
      "name": "idx_category"
    },
    {
      "fields": ["isActive", "priority"],
      "name": "idx_active_priority"
    }
  ]
}
