{
  "@type": "Schema",
  "@context": "https://rocketschema.org/context",
  "name": "UserGroup",
  "description": "A group of users - NORMALIZED VERSION (3NF compliant)",
  "properties": [
    {
      "name": "code",
      "type": "string",
      "mode": "stored",
      "description": "Unique group code",
      "required": true,
      "unique": true,
      "example": "SALES_TEAM"
    },
    {
      "name": "name",
      "type": "string",
      "mode": "stored",
      "description": "Group name",
      "required": true,
      "example": "Sales Team"
    },
    {
      "name": "description",
      "type": "string",
      "mode": "stored",
      "description": "Group description and purpose",
      "nullable": true
    },
    {
      "name": "type",
      "type": "string",
      "mode": "enum",
      "description": "Type of group",
      "enum": ["department", "team", "project", "security", "custom"],
      "default": "custom",
      "example": "team"
    },
    {
      "name": "parentGroup",
      "type": "UserGroup",
      "mode": "stored",
      "description": "Parent group for hierarchical organization",
      "nullable": true
    },
    {
      "name": "organization",
      "type": "Organization",
      "mode": "stored",
      "description": "Organization this group belongs to"
    },
    {
      "name": "maxMembers",
      "type": "integer",
      "mode": "stored",
      "description": "Maximum number of members allowed (null for unlimited)",
      "nullable": true,
      "min": 0
    },
    {
      "name": "currentMemberCount",
      "type": "integer",
      "mode": "stored",
      "description": "Current number of active members (denormalized for performance)",
      "default": 0,
      "min": 0
    },
    {
      "name": "isActive",
      "type": "boolean",
      "mode": "stored",
      "description": "Whether the group is active",
      "default": true
    },
    {
      "name": "isSystem",
      "type": "boolean",
      "mode": "stored",
      "description": "Whether this is a protected system group",
      "default": false
    },
    {
      "name": "autoJoinExpression",
      "type": "string",
      "mode": "stored",
      "description": "Expression for automatic group membership (CEL)",
      "nullable": true
    },
    {
      "name": "createdAt",
      "type": "DateTime",
      "mode": "stored",
      "description": "Creation timestamp",
      "required": true
    },
    {
      "name": "createdBy",
      "type": "User",
      "mode": "stored",
      "description": "User who created the group"
    },
    {
      "name": "updatedAt",
      "type": "DateTime",
      "mode": "stored",
      "description": "Last update timestamp"
    },
    {
      "name": "version",
      "type": "integer",
      "mode": "stored",
      "description": "Version number for optimistic locking",
      "default": 1
    }
  ],
  "relationships": {
    "members": {
      "type": "many-to-many",
      "entity": "User",
      "junction": "UserGroupMember"
    },
    "roles": {
      "type": "many-to-many",
      "entity": "Role",
      "junction": "UserGroupRole"
    },
    "permissions": {
      "type": "many-to-many",
      "entity": "Permission",
      "junction": "UserGroupPermission"
    }
  },
  "indexes": [
    {
      "fields": ["code"],
      "unique": true
    },
    {
      "fields": ["organization", "type"],
      "name": "idx_org_type"
    },
    {
      "fields": ["parentGroup"],
      "name": "idx_parent"
    },
    {
      "fields": ["isActive", "isSystem"],
      "name": "idx_active_system"
    }
  ]
}
