{
  "@type": "Schema",
  "@context": "https://rocketschema.org/context",
  "name": "TwoFactorAuth",
  "description": "Manages multi-factor authentication (MFA) configurations for enhanced security across any system requiring identity verification. This entity represents a single authentication factor beyond the primary credential, supporting various verification methods including time-based codes, delivery to verified contact points, hardware tokens, and biometric verification. Organizations use this to enforce security policies in banking systems, healthcare portals, enterprise applications, e-commerce platforms, and government services. Each principal (user, service account, API client) can register multiple authentication factors, with designation of primary and backup methods. The entity tracks verification status to ensure factors are proven functional before becoming active, monitors usage patterns for anomaly detection, and implements security controls like temporary lockouts after repeated failures. This universal pattern applies whether protecting patient records in healthcare, financial transactions in banking, or sensitive documents in legal systems. Cross-industry implementations share common requirements: proof of possession, rate limiting, recovery mechanisms, and audit trails for compliance with regulations like PCI-DSS, HIPAA, SOC2, and GDPR.",
  "properties": [
    {
      "name": "principal",
      "type": "SecurityPrincipal",
      "mode": "stored",
      "description": "The security principal (user, service, or system) that owns this authentication factor",
      "required": true
    },
    {
      "name": "factorType",
      "type": "string",
      "mode": "enum",
      "description": "Category of authentication factor being used for verification",
      "enum": [
        "timeBased",
        "smsDelivery",
        "emailDelivery",
        "pushNotification",
        "hardwareToken",
        "biometric",
        "recoveryCode"
      ],
      "required": true,
      "example": "timeBased"
    },
    {
      "name": "isActive",
      "type": "boolean",
      "mode": "stored",
      "description": "Whether this authentication factor is currently enabled and available for use",
      "required": true,
      "default": false
    },
    {
      "name": "isPrimary",
      "type": "boolean",
      "mode": "stored",
      "description": "Whether this factor is the default choice when multiple factors are available",
      "required": true,
      "default": false
    },
    {
      "name": "displayLabel",
      "type": "string",
      "mode": "stored",
      "description": "Human-readable label to help identify this factor among multiple registered factors",
      "required": true,
      "example": "Primary mobile device"
    },
    {
      "name": "encryptedSecret",
      "type": "string",
      "mode": "stored",
      "description": "Encrypted shared secret used for time-based code generation or cryptographic operations",
      "nullable": true,
      "private": true
    },
    {
      "name": "deliveryTarget",
      "type": "Contact",
      "mode": "stored",
      "description": "Reference to the contact point (phone, email) where verification codes should be delivered",
      "nullable": true
    },
    {
      "name": "deviceIdentifier",
      "type": "string",
      "mode": "stored",
      "description": "Unique identifier for hardware token or registered device (serial number, UUID, public key hash)",
      "nullable": true,
      "unique": true
    },
    {
      "name": "verifiedAt",
      "type": "DateTime",
      "mode": "stored",
      "description": "Timestamp when this factor was successfully verified and confirmed operational",
      "nullable": true
    },
    {
      "name": "lastUsedAt",
      "type": "DateTime",
      "mode": "stored",
      "description": "Most recent successful authentication using this factor",
      "nullable": true
    },
    {
      "name": "consecutiveFailures",
      "type": "integer",
      "mode": "stored",
      "description": "Count of sequential failed verification attempts since last success",
      "required": true,
      "default": 0,
      "min": 0
    },
    {
      "name": "lockedUntil",
      "type": "DateTime",
      "mode": "stored",
      "description": "Temporary suspension timestamp after exceeding failure threshold, preventing brute force attacks",
      "nullable": true
    },
    {
      "name": "expiresAt",
      "type": "DateTime",
      "mode": "stored",
      "description": "Optional expiration for time-limited factors such as temporary access or rotating credentials",
      "nullable": true
    },
    {
      "name": "metadata",
      "type": "object",
      "mode": "stored",
      "description": "Extensible storage for method-specific configuration (algorithm parameters, token specifications, biometric templates)",
      "nullable": true
    }
  ],
  "examples": [
    {
      "@type": "TwoFactorAuth",
      "principal": {
        "@type": "SecurityPrincipal",
        "principalType": "user",
        "identifier": "jdoe@example.org"
      },
      "factorType": "timeBased",
      "isActive": true,
      "isPrimary": true,
      "displayLabel": "Primary mobile device",
      "verifiedAt": "2024-01-15T10:00:00Z",
      "lastUsedAt": "2024-03-15T14:30:00Z",
      "consecutiveFailures": 0,
      "metadata": {
        "algorithm": "SHA256",
        "digits": 6,
        "period": 30
      }
    },
    {
      "@type": "TwoFactorAuth",
      "principal": {
        "@type": "SecurityPrincipal",
        "principalType": "user",
        "identifier": "asmith@corporation.net"
      },
      "factorType": "hardwareToken",
      "isActive": true,
      "isPrimary": false,
      "displayLabel": "Backup security token",
      "deviceIdentifier": "HWT-2024-X7K9P2M3",
      "verifiedAt": "2024-02-10T08:30:00Z",
      "lastUsedAt": "2024-03-12T11:45:00Z",
      "consecutiveFailures": 0,
      "expiresAt": "2026-02-10T00:00:00Z",
      "metadata": {
        "tokenType": "FIDO2",
        "publicKeyHash": "sha256:a3f7c9e2..."
      }
    },
    {
      "@type": "TwoFactorAuth",
      "principal": {
        "@type": "SecurityPrincipal",
        "principalType": "service",
        "identifier": "api-gateway-prod"
      },
      "factorType": "pushNotification",
      "isActive": true,
      "isPrimary": true,
      "displayLabel": "Mobile application authenticator",
      "deliveryTarget": {
        "@type": "Contact",
        "contactType": "mobile",
        "value": "+1-555-987-6543"
      },
      "verifiedAt": "2024-03-01T09:00:00Z",
      "lastUsedAt": "2024-03-14T16:20:00Z",
      "consecutiveFailures": 1,
      "metadata": {
        "pushProvider": "platform",
        "encryptionVersion": "v2"
      }
    }
  ]
}
