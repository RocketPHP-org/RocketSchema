{
  "@type": "Schema",
  "@context": "https://rocketschema.org/context",
  "name": "ApiKeyPermission",
  "description": "Junction table that links API keys to specific permissions, implementing fine-grained access control for programmatic access. While API key scopes define broad categories of access (like 'users:read'), permissions represent specific, granular rights within the system (like 'can_view_user_emails' or 'can_export_data'). This many-to-many relationship allows flexible permission assignment where the same permission can be granted to multiple API keys, and each key can have multiple permissions. This entity tracks not just what permissions are granted, but also who granted them, when they become effective, and when they expire. Temporary permissions are useful for time-limited access, like giving a contractor's API key elevated permissions only during their project. The system evaluates these permissions on every API request, combining them with scopes to determine if an action is allowed. This dual-layer approach (scopes + permissions) provides both simplicity for common cases and flexibility for complex authorization requirements. It's particularly useful when different API keys need slightly different access to the same resources.",
  "properties": [
    {
      "name": "apiKey",
      "type": "ApiKey",
      "mode": "stored",
      "description": "The API key receiving this permission",
      "required": true
    },
    {
      "name": "grantedAt",
      "type": "DateTime",
      "mode": "stored",
      "description": "When this permission was assigned",
      "required": true
    },
    {
      "name": "grantedBy",
      "type": "User",
      "mode": "stored",
      "description": "Administrator who granted this permission",
      "nullable": true
    },
    {
      "name": "reason",
      "type": "string",
      "mode": "stored",
      "description": "Explanation for why this permission was granted",
      "nullable": true,
      "example": "Required for Q4 data migration project"
    },
    {
      "name": "validFrom",
      "type": "DateTime",
      "mode": "stored",
      "description": "When this permission becomes active",
      "nullable": true
    },
    {
      "name": "validUntil",
      "type": "DateTime",
      "mode": "stored",
      "description": "When this permission expires",
      "nullable": true
    },
    {
      "name": "conditions",
      "type": "string",
      "mode": "stored",
      "description": "JSON conditions that must be met for permission to apply",
      "nullable": true,
      "example": "{\"ip_range\": \"10.0.0.0/8\", \"time_of_day\": \"09:00-17:00\"}"
    },
    {
      "name": "isActive",
      "type": "boolean",
      "mode": "stored",
      "description": "Whether this permission grant is currently active",
      "default": true
    },
    {
      "name": "revokedAt",
      "type": "DateTime",
      "mode": "stored",
      "description": "When this permission was revoked",
      "nullable": true
    },
    {
      "name": "revokedBy",
      "type": "User",
      "mode": "stored",
      "description": "Who revoked this permission",
      "nullable": true
    },
    {
      "name": "revokedReason",
      "type": "string",
      "mode": "stored",
      "description": "Why the permission was revoked",
      "nullable": true
    },
    {
      "name": "lastUsedAt",
      "type": "DateTime",
      "mode": "stored",
      "description": "Last time this permission was checked",
      "nullable": true
    },
    {
      "name": "usageCount",
      "type": "integer",
      "mode": "stored",
      "description": "Number of times this permission was used",
      "default": 0
    }
  ],
  "examples": [
    {
      "@type": "ApiKeyPermission",
      "grantedAt": "2024-03-01T10:00:00Z",
      "grantedBy": "admin_123",
      "reason": "Monthly user data export for analytics team",
      "validFrom": "2024-03-01T00:00:00Z",
      "validUntil": "2024-03-31T23:59:59Z",
      "conditions": "{\"rate_limit\": \"1_per_day\", \"max_records\": 10000}",
      "isActive": true,
      "lastUsedAt": "2024-03-15T02:00:00Z",
      "usageCount": 15,
      "apiKey": "key_550e8400"
    },
    {
      "@type": "ApiKeyPermission",
      "grantedAt": "2024-02-15T14:00:00Z",
      "grantedBy": "manager_456",
      "reason": "Temporary access for data cleanup project",
      "validFrom": "2024-02-15T14:00:00Z",
      "validUntil": "2024-02-20T18:00:00Z",
      "isActive": false,
      "revokedAt": "2024-02-19T16:30:00Z",
      "revokedBy": "manager_456",
      "revokedReason": "Project completed ahead of schedule",
      "lastUsedAt": "2024-02-19T15:45:00Z",
      "usageCount": 47,
      "apiKey": "key_contractor_789"
    }
  ]
}