{
  "@type": "Schema",
  "@context": "https://rocketschema.org/context",
  "name": "User",
  "description": "A system user account - NORMALIZED VERSION (3NF compliant)",
  "properties": [
    {
      "name": "userId",
      "type": "uuid",
      "mode": "stored",
      "description": "Unique user identifier",
      "required": true,
      "unique": true
    },
    {
      "name": "username",
      "type": "string",
      "mode": "stored",
      "description": "Unique username for authentication",
      "required": true,
      "unique": true,
      "example": "john.doe"
    },
    {
      "name": "email",
      "type": "string",
      "mode": "stored",
      "description": "Primary email address",
      "required": true,
      "unique": true,
      "format": "email",
      "example": "john.doe@example.com"
    },
    {
      "name": "emailVerified",
      "type": "boolean",
      "mode": "stored",
      "description": "Whether the email address has been verified",
      "default": false
    },
    {
      "name": "emailVerifiedAt",
      "type": "DateTime",
      "mode": "stored",
      "description": "Timestamp when email was verified",
      "nullable": true
    },
    {
      "name": "person",
      "type": "Person",
      "mode": "stored",
      "description": "Reference to Person entity for demographic information",
      "nullable": true
    },
    {
      "name": "status",
      "type": "string",
      "mode": "enum",
      "description": "Account status",
      "enum": ["active", "inactive", "suspended", "locked", "pending"],
      "default": "pending",
      "example": "active"
    },
    {
      "name": "statusReason",
      "type": "string",
      "mode": "stored",
      "description": "Reason for current status",
      "nullable": true
    },
    {
      "name": "statusChangedAt",
      "type": "DateTime",
      "mode": "stored",
      "description": "When status was last changed"
    },
    {
      "name": "locale",
      "type": "string",
      "mode": "stored",
      "description": "User's preferred locale",
      "default": "en-US",
      "example": "en-US"
    },
    {
      "name": "timezone",
      "type": "string",
      "mode": "stored",
      "description": "User's timezone",
      "default": "UTC",
      "example": "America/New_York"
    },
    {
      "name": "registeredAt",
      "type": "DateTime",
      "mode": "stored",
      "description": "Registration timestamp",
      "required": true
    },
    {
      "name": "registrationSource",
      "type": "string",
      "mode": "enum",
      "description": "How the user registered",
      "enum": ["web", "mobile", "api", "admin", "import", "social"],
      "example": "web"
    },
    {
      "name": "registrationIp",
      "type": "string",
      "mode": "stored",
      "description": "IP address at registration",
      "nullable": true
    },
    {
      "name": "activatedAt",
      "type": "DateTime",
      "mode": "stored",
      "description": "Account activation timestamp",
      "nullable": true
    },
    {
      "name": "deactivatedAt",
      "type": "DateTime",
      "mode": "stored",
      "description": "Account deactivation timestamp",
      "nullable": true
    },
    {
      "name": "deletedAt",
      "type": "DateTime",
      "mode": "stored",
      "description": "Soft delete timestamp",
      "nullable": true
    },
    {
      "name": "version",
      "type": "integer",
      "mode": "stored",
      "description": "Version number for optimistic locking",
      "default": 1
    },
    {
      "name": "createdAt",
      "type": "DateTime",
      "mode": "stored",
      "description": "Creation timestamp",
      "required": true
    },
    {
      "name": "updatedAt",
      "type": "DateTime",
      "mode": "stored",
      "description": "Last update timestamp"
    }
  ],
  "relationships": {
    "authentication": {
      "type": "one-to-one",
      "entity": "UserAuthentication",
      "foreign_key": "userId"
    },
    "sessions": {
      "type": "one-to-many",
      "entity": "UserSession",
      "foreign_key": "userId"
    },
    "preferences": {
      "type": "one-to-many",
      "entity": "UserPreference",
      "foreign_key": "userId"
    },
    "notifications": {
      "type": "one-to-many",
      "entity": "UserNotification",
      "foreign_key": "userId"
    },
    "twoFactorMethods": {
      "type": "one-to-many",
      "entity": "TwoFactorAuth",
      "foreign_key": "userId"
    },
    "apiKeys": {
      "type": "one-to-many",
      "entity": "ApiKey",
      "foreign_key": "userId"
    }
  },
  "indexes": [
    {
      "fields": ["userId"],
      "unique": true
    },
    {
      "fields": ["username"],
      "unique": true
    },
    {
      "fields": ["email"],
      "unique": true
    },
    {
      "fields": ["status", "registeredAt"],
      "name": "idx_status_registered"
    },
    {
      "fields": ["deletedAt"],
      "name": "idx_soft_delete"
    }
  ]
}
